<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Gardner">

<title>Notes on using R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="NotesOnR_files/libs/clipboard/clipboard.min.js"></script>
<script src="NotesOnR_files/libs/quarto-html/quarto.js"></script>
<script src="NotesOnR_files/libs/quarto-html/popper.min.js"></script>
<script src="NotesOnR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="NotesOnR_files/libs/quarto-html/anchor.min.js"></script>
<link href="NotesOnR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="NotesOnR_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="NotesOnR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="NotesOnR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="NotesOnR_files/libs/bootstrap/bootstrap-e1f28e2ad4a19b8fd1b1fa1a01a3cf45.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">Basics</a>
  <ul class="collapse">
  <li><a href="#getting-r-and-r-studio" id="toc-getting-r-and-r-studio" class="nav-link" data-scroll-target="#getting-r-and-r-studio">Getting R (and R Studio)</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#interacting-with-r" id="toc-interacting-with-r" class="nav-link" data-scroll-target="#interacting-with-r">Interacting with R</a></li>
  </ul></li>
  <li><a href="#types-of-data" id="toc-types-of-data" class="nav-link" data-scroll-target="#types-of-data">Types of data</a>
  <ul class="collapse">
  <li><a href="#vectors" id="toc-vectors" class="nav-link" data-scroll-target="#vectors">Vectors</a></li>
  <li><a href="#lists" id="toc-lists" class="nav-link" data-scroll-target="#lists">Lists</a></li>
  <li><a href="#matrices" id="toc-matrices" class="nav-link" data-scroll-target="#matrices">Matrices</a></li>
  <li><a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames">Data frames</a></li>
  </ul></li>
  <li><a href="#programming-tools" id="toc-programming-tools" class="nav-link" data-scroll-target="#programming-tools">Programming tools</a>
  <ul class="collapse">
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#loops" id="toc-loops" class="nav-link" data-scroll-target="#loops">Loops</a></li>
  <li><a href="#conditionals-and-while-loops" id="toc-conditionals-and-while-loops" class="nav-link" data-scroll-target="#conditionals-and-while-loops">Conditionals and while loops</a></li>
  <li><a href="#apply-functions" id="toc-apply-functions" class="nav-link" data-scroll-target="#apply-functions">Apply functions</a></li>
  </ul></li>
  <li><a href="#working-with-data" id="toc-working-with-data" class="nav-link" data-scroll-target="#working-with-data">Working with data</a>
  <ul class="collapse">
  <li><a href="#reading-and-writing-data" id="toc-reading-and-writing-data" class="nav-link" data-scroll-target="#reading-and-writing-data">Reading and writing data</a></li>
  <li><a href="#subsetting-data" id="toc-subsetting-data" class="nav-link" data-scroll-target="#subsetting-data">Subsetting data</a></li>
  <li><a href="#transforming-data" id="toc-transforming-data" class="nav-link" data-scroll-target="#transforming-data">Transforming data</a></li>
  <li><a href="#merging-and-reshaping-data" id="toc-merging-and-reshaping-data" class="nav-link" data-scroll-target="#merging-and-reshaping-data">Merging and reshaping data</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary statistics</a></li>
  <li><a href="#visualizing-data" id="toc-visualizing-data" class="nav-link" data-scroll-target="#visualizing-data">Visualizing data</a></li>
  <li><a href="#regression-basics" id="toc-regression-basics" class="nav-link" data-scroll-target="#regression-basics">Regression basics</a></li>
  </ul></li>
  <li><a href="#resources-for-more" id="toc-resources-for-more" class="nav-link" data-scroll-target="#resources-for-more">Resources for more</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Notes on using R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Gardner </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>These notes are a tutorial on using R for empirical projects. I have tried to keep it short while still touching on the topics you need to know about to start using R for your own work. There is much to know about R, and I encourage interested readers to consult the resources at the end of the notes for even more information.</p>
</section>
<section id="basics" class="level2">
<h2 class="anchored" data-anchor-id="basics">Basics</h2>
<section id="getting-r-and-r-studio" class="level3">
<h3 class="anchored" data-anchor-id="getting-r-and-r-studio">Getting R (and R Studio)</h3>
<p>You can download R from <a href="https://www.r-project.org" class="uri">https://www.r-project.org</a>. Technically this is all you need, but most people prefer to work in the RStudio editor, which makes it easy for you to run commands, view graphs and data, browse through help files, and more. You can download RStudio for free from <a href="https://posit.co" class="uri">https://posit.co</a> (they also offer an editor called Positron that works with R and Python, but I don’t have any experience with it).</p>
</section>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">Packages</h3>
<p>Packages extend R’s functionality. You can install them using <code>install.packages("packagename")</code> and load them for use using <code>library(packagename)</code> (note the you use quotes when installing but not loading). You can also use a command from a package without loading it using the syntax <code>packagename::command</code>.</p>
<p><strong>Base R, Tidyverse, and data.table.</strong> The <em>Tidyverse</em> is a popular set of packages that provide different ways of working in R, and refine some of R’s built-in capabilities. They can be loaded using <code>library(tidyverse)</code>. I recommend learning how to do things using R’s built-in capabilities (“base R”) as well as using the Tidyverse, since they both have their advantages. Another popular package for data manipulation which I don’t discuss here is data.table, which is capable and fast, and may be of interest to you, particularly if you work with very large datasets.</p>
</section>
<section id="interacting-with-r" class="level3">
<h3 class="anchored" data-anchor-id="interacting-with-r">Interacting with R</h3>
<p>You can use R by directly typing commands into the <em>console</em> (the command line in the bottom window), but it is much better to create an R script (ending in <code>.R</code>), which contains a record of all of your commands. In RStudio, you can run the selected line by clicking the <code>Run</code> button, or by hitting <code>Command + Enter</code> on macOS or <code>Ctrl + Enter</code> on Windows. You can also run the entire file by selecting <code>Run all</code> from the dropdown menu on the <code>Run</code> button.</p>
<p>If you prefer, you can also run an entire R script using the command <code>source("filename.R")</code>. Before you do this, you will need to set the working directory to the path of your script file, which you can do using the command <code>setwd("path/to/file")</code>. If you prefer to use backslashes on Windows, you will need to <em>escape</em> them, so your command will look like <code>setwd("path\\to\\file")</code>.</p>
<p>It’s a good idea to comment your R scripts with notes about the purpose of your code. You can use the <code>#</code> character to start a comment. In RStudio, you can also type <code>Command + Shift + R</code> to insert a nice-looking separator line.</p>
<p>You can view the documentation for any command by typing <code>help(commandname)</code> (this may take you to a page of search results if there are multiple similarly named commands). For me, the R documentation is hit or miss: sometimes it answers my questions and teaches me about new and useful options/commands, sometimes it’s frustratingly terse. You get used to it, and you can always try a web search or LLM.</p>
</section>
</section>
<section id="types-of-data" class="level2">
<h2 class="anchored" data-anchor-id="types-of-data">Types of data</h2>
<p>The main data types that you will work with in R are <em>vectors</em>, <em>lists</em>, <em>matrices</em>, and <em>data frames</em> (there are also <em>arrays</em>, which generalize matrices and include matrices and data frames as a subset, but we won’t be working with them).</p>
<section id="vectors" class="level3">
<h3 class="anchored" data-anchor-id="vectors">Vectors</h3>
<p>A vector is a list of entries that are all the same <em>type</em> (usually numeric or character). You can create a vector using the concatenate function <code>c()</code> and assign it a name using the assignment operator <code>&lt;-</code>:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can determine an object’s type by using the <code>class</code> command. You can refer to the elements of a vector using <code>a[1]</code>, or for multiple elements, <code>a[1:2]</code>. You can add/subtract and perform elementwise multiplication/division on numeric vectors using <code>+</code>, <code>-</code>, <code>*</code>, and <code>/</code>. Transformations are <em>vectorized</em>, meaning that they will be applied to all elements of a vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>a <span class="sc">-</span> b</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">*</span> b</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>a <span class="sc">/</span> b</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(a)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>b<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you have a vector of categorical data, you can turn it into a <em>factor</em> using the <code>factor</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fac.a <span class="ot">&lt;-</span> <span class="fu">factor</span>(a)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fac.a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3
Levels: 1 2 3</code></pre>
</div>
</div>
<p>You can also work with a vector as though it had been converted to a factor using the <code>as.factor</code> function. R provides facilities for working with factor variables (see <code>help(factor)</code>), although often you can simply leave them as numeric vectors.</p>
</section>
<section id="lists" class="level3">
<h3 class="anchored" data-anchor-id="lists">Lists</h3>
<p>A list is essentially a vector where not every element is of the same type. Lists can include vectors or other lists as elements. You can create a list using the <code>list()</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">list</span>(a, b, c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can view the structure of a list (or any object in R) using the <code>str</code> function. Referring to elements of a list works a little differently: <code>e[1]</code> returns a list that contains the vector <code>(1, 2, 3)</code>, while <code>e[[1]]</code> returns the vector <code>(1, 2, 3)</code> itself. Hence, <code>class(e[1])</code> returns <code>list</code> while <code>class(e[[1]])</code> returns <code>numeric</code>.</p>
<p>You can add names to the elements of a list using the <code>names</code> function, or when creating the list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(e) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> a, <span class="at">b =</span> b, <span class="at">c =</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(In the above, <code>a = a</code> means that the element named “a” takes the value <code>a</code>.) You can refer to the elements of a named list using <code>e[["a"]]</code> or <code>e$a</code>, both of which mean the same thing.</p>
</section>
<section id="matrices" class="level3">
<h3 class="anchored" data-anchor-id="matrices">Matrices</h3>
<p>A matrix is a collection of vectors that all have the same type and length. You can create a matrix using the <code>matrix</code> function. By default, R creates matrices by filling in the columns (this can be reversed using the <code>by.row = TRUE</code> option). All of the following create the same matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="at">by=</span><span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    3
[2,]    2    4</code></pre>
</div>
</div>
<p>You can create an <span class="math inline">\(n \times k\)</span> matrix of zeros using <code>matrix(0, n, k)</code> or an <span class="math inline">\(n \times n\)</span> identity matrix using <code>diag(n)</code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> You can refer to the elements of a matrix using, e.g., <code>g[1, 2]</code> or a submatrix using <code>g[1:2, 2]</code> (the first entry is the row, the second is the column). You can name the rows of a matrix using <code>rownames</code> and the columns using <code>colnames</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(h) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"r1"</span>, <span class="st">"r2"</span>, <span class="st">"r3"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(h) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1 x2 x3
r1  1  4  7
r2  2  5  8
r3  3  6  9</code></pre>
</div>
</div>
<p>If the rows or columns of a matrix are named, you can subset the matrix using row or column names intead of numbers, as in <code>h[c("r1", "r2"), c("x1", "x3")]</code>. You can also index a matrix by another matrix. For example, the following returns a vector containing the third element of the first row of <code>h</code>, the second element of the second row, and the first element of the third row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    3
[2,]    2    2
[3,]    3    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>h[index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7 5 3</code></pre>
</div>
</div>
<p><code>cbind</code> stands for column bind, and allows you to append two columns side by side (there is also <code>rbind</code>, which operators analogously on rows). Note that <code>h[index]</code> returns a vector.</p>
<p>Matrix addition works as you might expect. The <code>%*%</code> operator performs matrix multiplication on conformable matrices, while <code>*</code> does element by element multiplication. You can invert a matrix using <code>solve</code> and transpose it using <code>t</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    5    7
[2,]    6    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">%*%</span> i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   23   31
[2,]   34   46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">*</span> i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    5   21
[2,]   12   32</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   -2  1.5
[2,]    1 -0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    2
[2,]    3    4</code></pre>
</div>
</div>
<p>If you multiply a matrix by a vector elementwise (using <code>*</code>), or add a matrix and a vector, R will use the “recycling rule” to turn the vector into a conformable matrix. Since R fills matrices columnwise, this means that elementwise multiplication of the matrix <code>g</code> by the vector <code>j</code> in the following is the same as multiplying <code>g</code> by a matrix consisting of two copies of <code>j</code>, stacked side-by-side:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>g <span class="sc">*</span> j</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    3
[2,]    4    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> j</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    2    4
[2,]    4    6</code></pre>
</div>
</div>
<p>R will interpret <code>j</code> as a row vector if you pre-multiply <code>g</code> by <code>j</code> (using matrix multiplication <code>%*%</code>), and as a column vector if you post-multiply <code>g</code> by <code>j</code> (i.e., <code>j %*% g</code> is equivalent to <code>matrix(j, nrow=1) %*% g</code>).</p>
</section>
<section id="data-frames" class="level3">
<h3 class="anchored" data-anchor-id="data-frames">Data frames</h3>
<p>A data frame is basically a list of vectors that all have the same length (i.e., a dataset). You can create a data frame using the <code>data.frame</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(a, b, c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since a data frame is a list, you can subset it using the same rules as for lists. For example, <code>dat["a"]</code> returns a data frame consisting of only the variable <code>a</code>, while <code>dat[["a"]]</code> and <code>dat$a</code> return the variable (vector) <code>a</code> itself. You can also subset data frames like matrices, so <code>dat[2:3, c("a", "c")]</code> returns a data frame consisting of the second and third observations on the variables <code>a</code> and <code>c</code>. To subset a data frame (or matrix) according to a condition, you can use <code>dat[dat$a==1, ]</code>, <code>dat[dat$a!=1]</code>, <code>dat[dat$a&gt;1, ]</code>, etc. Note here that we use <code>==</code> to check if a condition holds and <code>!=</code> to check if it’s false (when evaluating a character variable, we put the condition in quotes, as in <code>char.var == "a"</code>). Also note that we still have to preface column names by <code>dat$</code> when subscripting (this actually comes in handy because you can subset a data frame or matrix according a vector that isn’t one of its columns).</p>
<p>You can preview a data frame (or vector) using <code>str(dat)</code>, <code>head(dat)</code>, or in the Tidyverse, <code>glimpse(dat)</code>. In RStudio, you can also view a data frame (or any data object) by typing <code>View(dat)</code>, or by double clicking on it in the <em>Environment</em> pane.</p>
</section>
</section>
<section id="programming-tools" class="level2">
<h2 class="anchored" data-anchor-id="programming-tools">Programming tools</h2>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>You can extend R by writing your own functions. For example, suppose that you are working with the <code>mtcars</code> dataset (which comes with R and contains characteristics of different cars), and you want to know how average milage changes with the number of cylinders a car has. While there are built-in functions to handle this kind of thing, you can also write your own:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cyl.mean.mpg <span class="ot">&lt;-</span> <span class="cf">function</span>(cylinders) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>cylinders, ]<span class="sc">$</span>mpg)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cyl.mean.mpg</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.66364</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cyl.mean.mpg</span>(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.74286</code></pre>
</div>
</div>
<p>This illustrates the basic use of <code>function</code>, but there are a few ways that we can make our function more useful. R functions can accept multiple inputs. And while by default they return the last object created, we can also specify what we want the function to return, which can be a scalar, vector, matrix or list.</p>
<p>Here is a somewhat more complex version of our function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cyl.stats <span class="ot">&lt;-</span> <span class="cf">function</span>(cylinders, variable) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>cylinders, ][[variable]])</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>cylinders, ][[variable]])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">sd =</span> sd))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cyl.stats</span>(<span class="dv">4</span>, <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mean
[1] 26.66364

$sd
[1] 4.509828</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cyl.stats</span>(<span class="dv">6</span>, <span class="st">"wt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mean
[1] 3.117143

$sd
[1] 0.3563455</code></pre>
</div>
</div>
<p>This function takes two arguments, <code>cylinders</code> and <code>variable</code>, and returns a list containing the mean and standard deviation of <code>variable</code> among all cars with the specified number of cylinders.</p>
</section>
<section id="loops" class="level3">
<h3 class="anchored" data-anchor-id="loops">Loops</h3>
<p>Loops allow you to perform actions iteratively. As a simple example, we could use a loop to run our basic <code>cyl.mean.mpg</code> function for cars with 4, 6, or 8 cylinders:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>) </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  means[i] <span class="ot">&lt;-</span> <span class="fu">cyl.mean.mpg</span>(values[i])</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.66364 19.74286 15.10000</code></pre>
</div>
</div>
<p>A few notes on this: We initially set <code>means</code> to a vector of zeros with the correct final length (an alternative would be to build the vector <code>means</code> by joining the result of each iteration with the previous one). On bigger jobs, this makes the loop faster because R doesn’t have to make a new copy of the vector each time. Also, we use <code>cyl.mean.mpg(values[i])</code> to make sure that the first entry in <code>means</code> consists of the <em>value</em> of the first element of <code>values</code>, and so on.</p>
<p>One limitation of the loop above is that we had to specify the values of cylinders. We can avoid this by having R determine the possible values of <code>cyl</code> and the length of <code>means</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(values))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(values)) {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  means[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>values[i], ]<span class="sc">$</span>mpg)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.66364 19.74286 15.10000</code></pre>
</div>
</div>
<p>Here, <code>sort(unique(mtcars$cyl))</code> gives us the unique values of <code>cyl</code> (in increasing order, as opposed to the order in which they occur, which <code>unique</code> provides by default), and <code>seq_along(cyls)</code> tells the loop to iterate over those values (this is basically the same as saying <code>for (i in 1:length(values))</code>, but won’t throw an error if the length is zero). Note that we could have also called our <code>cyl.mean.mpg</code> function inside the loop instead of defining the value of <code>means</code> “by hand”.</p>
<p>Loops can be nested. If we wanted to know how the means of both <code>mpg</code> and <code>wt</code> change with <code>cyl</code>, we could use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span><span class="fu">length</span>(values), <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(values)) {</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(vars)) {</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    means[i, j] <span class="ot">&lt;-</span> <span class="fu">cyl.stats</span>(values[i], vars[j])[[<span class="dv">1</span>]]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(means) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"cyl = "</span>, values)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(means) <span class="ot">&lt;-</span> vars</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             mpg       wt
cyl = 4 26.66364 2.285727
cyl = 6 19.74286 3.117143
cyl = 8 15.10000 3.999214</code></pre>
</div>
</div>
<p>As we will see below, loops are useful for modifying a data frame. They can also be used to modify objects that aren’t elements of an existing data frame. For example, suppose that we wanted the exponential of three matrices, <code>x1</code>, <code>x2</code>, and <code>x3</code>. One way we could create these matrices using a loop is with the <code>assign</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, i), <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">4</span>), <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use the <code>paste0</code> function to create the strings “x1”, “x2”, and “x3” (there is also <code>paste</code>, which allows you to specify a separator like “<code>_</code>”). If we tried to say <code>paste0("x", 1) &lt;- matrix(...)</code>, we’d get an error message because R would think we were trying to assign something to the literal string “x1”. Instead, we use the <code>assign</code> function to tell R that we are creating an object whose name is that string. We also use the <code>runif</code> function to populate the matrices with pseudo-random draws from a uniform distribution (and seed the random number generator to make sure that we get the same values every time).</p>
<p>We could also use a loop to define transformations of these matrices. To do this, we use the <code>get</code> function (which is the inverse of <code>assign</code>) to retrieve the objects whose names are given by the strings “x1”, “x2”, and “x3”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, i, <span class="st">"_exp"</span>), <span class="fu">exp</span>(<span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, i))))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, we could collect our matrices into a list, then work with the list. The <code>mget</code> function allows us to <code>get</code> a list of multiple objects, all at once. Once we have a list, we can iterate through the elements of the list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>matrices <span class="ot">&lt;-</span> <span class="fu">mget</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  matrices[[i]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(matrices[[i]])</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first time I tried this, I accidentally typed <code>exp(matrices[i])</code> and got an error, because <code>matrices[1]</code> is a list containing <code>x1</code> (which can’t be exponentiated), while <code>matrices[[1]]</code> is the matrix <code>x1</code> itself, which can. Now, we could return to the <code>assign</code> function to add these transformed matrices as objects in our environments. Alternatively, we can use the <code>list2env</code> function, which handles this for us (in this case, we have to tell R to save the matrices in the <em>global environment</em>, which is the main workspace where objects are stored):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(matrices) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"_exp"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list2env</span>(matrices, <span class="at">envir =</span> .GlobalEnv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conditionals-and-while-loops" class="level3">
<h3 class="anchored" data-anchor-id="conditionals-and-while-loops">Conditionals and while loops</h3>
<p>Instead of looping over a set index, we can use <code>while</code> to continue looping while a condition is met. Similarly, we can use <code>if</code>, <code>else if</code> and <code>else</code> to execute commands based on whether a condition is met.</p>
<p>In the following example, we illustrate these commands by using the bisection method to find the positive root of <span class="math inline">\(f(x) = x^2 - 16\)</span>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">16</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># initial values</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>low <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>high <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># no. of iterations</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (eps <span class="sc">&gt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">5</span>)) {</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  mid <span class="ot">&lt;-</span> .<span class="dv">5</span><span class="sc">*</span>(low <span class="sc">+</span> high)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">f</span>(mid))</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">f</span>(low) <span class="sc">*</span> <span class="fu">f</span>(mid) <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    high <span class="ot">&lt;-</span> mid</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    low <span class="ot">&lt;-</span> mid</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>eps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.629395e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.000001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
</section>
<section id="apply-functions" class="level3">
<h3 class="anchored" data-anchor-id="apply-functions">Apply functions</h3>
<p>Loops are useful programming tools, but sometimes it is more convenient to use one of the “apply” family of functions, which are abstractions of loops known as <em>functionals</em> (programming with them is called <em>functional programming</em>).</p>
<p>The <code>apply</code> function itself applies a function to every row or column of an array (e.g., a matrix or data frame). For example, if we wanted the mean of every column of <code>mtcars</code>, we could use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       mpg        cyl       disp         hp       drat         wt       qsec 
 20.090625   6.187500 230.721875 146.687500   3.596563   3.217250  17.848750 
        vs         am       gear       carb 
  0.437500   0.406250   3.687500   2.812500 </code></pre>
</div>
</div>
<p>Or, if we wanted the sum of every row of the matrix <code>x1</code>, we could use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(x1, <span class="dv">1</span>, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.481886 1.761898</code></pre>
</div>
</div>
<p>The <code>lapply</code> function applies a function to every element of a list (I think of this as a general-purpose substitute for loops) and returns the results as a list.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> For example, instead of using a loop to get the mean mileage for every value of cylinder, we can use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl), cyl.mean.mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 19.74286

[[2]]
[1] 26.66364

[[3]]
[1] 15.1</code></pre>
</div>
</div>
<p>Note that, here, we don’t need to use constructs like <code>seq_along</code> – <code>lapply</code> automatically sets the first element of the output list to the value of <code>cyl.mean.mpg</code> applied to the first element of the input list, and so on.</p>
<p>We can also define functions within the <code>lapply</code> statement. Both of the following produce the same result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl), </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(x) <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>x, ]<span class="sc">$</span>mpg))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl), \(x) <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>x, ]<span class="sc">$</span>mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>\(x)</code> syntax is called an <em>anonymous function</em>, but it’s just a shorthand for the usual function syntax. Also note that for short functions, we can dispense with the braces and just type <code>function(x) thing_to_do</code>.</p>
<p>You can also use <code>lapply</code> with functions that take multiple arguments by supplying additional arguments after the function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl), cyl.stats, <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[[1]]$mean
[1] 19.74286

[[1]]$sd
[1] 1.453567


[[2]]
[[2]]$mean
[1] 26.66364

[[2]]$sd
[1] 4.509828


[[3]]
[[3]]$mean
[1] 15.1

[[3]]$sd
[1] 2.560048</code></pre>
</div>
</div>
<p>There is a variant of <code>lapply</code> called <code>sapply</code> that tries to simplify the output as a vector or matrix, if possible (the “s” stands for simplify):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">unique</span>(mtcars<span class="sc">$</span>cyl), \(x) <span class="fu">mean</span>(mtcars[mtcars<span class="sc">$</span>cyl<span class="sc">==</span>x,]<span class="sc">$</span>mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.74286 26.66364 15.10000</code></pre>
</div>
</div>
<p>The <code>tapply</code> command applies a function to a vector within groups defined by levels of another vector. We could have been using <code>tapply</code> instead of our <code>cyl.mpg.mean</code> function all along:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       4        6        8 
26.66364 19.74286 15.10000 </code></pre>
</div>
</div>
<p>This is equivalent to using the <code>split</code> command to make a list of vectors, each containing the values of <code>mpg</code> for a particular level of <code>cyl</code>, then using <code>sapply</code> on that list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mpg.split <span class="ot">&lt;-</span> <span class="fu">split</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(mpg.split, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       4        6        8 
26.66364 19.74286 15.10000 </code></pre>
</div>
</div>
<p>We can also use <code>lapply</code> instead of loops to work with lists of data objects. Let’s use the <code>rm</code> command to remove our modified matrices, then recreate then using <code>lapply</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"_exp"</span>), matrices)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>matrices <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), get)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>matrices_exp <span class="ot">&lt;-</span> <span class="fu">lapply</span>(matrices, exp)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(matrices_exp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"_exp"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, \(i) <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, i, <span class="st">"_exp"</span>), </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                        matrices_exp[[i]], </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">envir =</span> .GlobalEnv))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
         [,1]     [,2]
[1,] 2.056291 2.140378
[2,] 2.400731 2.425711

[[2]]
         [,1]     [,2]
[1,] 1.578509 1.384163
[2,] 1.181012 1.664000

[[3]]
         [,1]     [,2]
[1,] 2.070324 1.035139
[2,] 2.690527 1.164595</code></pre>
</div>
</div>
<p>The above illustrates how <code>lapply</code> can be used in conjunction with <code>get</code> and <code>assign</code> to replicate the functionality provided by the <code>mget</code> and <code>list2env</code> commands. Note that, when we use <code>assign</code> inside a function, we have to specify the environment (as we did when using <code>list2env</code>), which we didn’t have to do when using a loop.</p>
<p>There are two other functions that are useful for functional programming. Suppose that you wanted to use <code>cbind</code> to join a list of matrices or data frames. It’s straightforward to do this with a loop (<code>NULL</code> below is a convenient way to define an object which is initially empty):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>big.matrix <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(matrices)) {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  big.matrix <span class="ot">&lt;-</span> <span class="fu">cbind</span>(big.matrix, matrices[[i]])</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>big.matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]      [,3]      [,4]      [,5]       [,6]
[1,] 0.7209039 0.7609823 0.4564810 0.3250954 0.7277053 0.03453544
[2,] 0.8757732 0.8861246 0.1663718 0.5092243 0.9897369 0.15237349</code></pre>
</div>
</div>
<p>What if you are using <code>apply</code> functions instead? <code>do.call</code> applies a function with the elements of a list as its arguments. For example, the following is equivalent to the loop above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(cbind, matrices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]      [,3]      [,4]      [,5]       [,6]
[1,] 0.7209039 0.7609823 0.4564810 0.3250954 0.7277053 0.03453544
[2,] 0.8757732 0.8861246 0.1663718 0.5092243 0.9897369 0.15237349</code></pre>
</div>
</div>
<p><code>Reduce</code> applies a function to the first to elements of a list, then applies the function to the result of the first step and the third element of the list, and so on. In this case, <code>Reduce(cbind, matrices)</code> produces the same result as <code>do.call</code>. However, <code>Reduce</code> also allows you to view the intermediate steps (we could replace <code>`+`</code> below with <code>sum</code>; the former shows how we can refer to symbolic mathematical operators):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">accumulate=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  3  6 10 15</code></pre>
</div>
</div>
<p><strong>Loops vs.&nbsp;functionals.</strong> In R, a vectorized command like <code>v &lt;- c(1:5)^2</code> is much faster than the loop <code>for (i in 1:5) v[i] &lt;- i^2</code>. However, apply-style functions are really just a more concise way of writing a loop (and sometimes more concise means harder to code), so you should use whatever works best for the task at hand.</p>
</section>
</section>
<section id="working-with-data" class="level2">
<h2 class="anchored" data-anchor-id="working-with-data">Working with data</h2>
<section id="reading-and-writing-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-and-writing-data">Reading and writing data</h3>
<p>R can read many different types of data files, but I am going to focus on the most common types. One frequently used format that is easy to work with is CSV (comma seperated value). If you have a csv file named <code>data.csv</code> saved on your desktop (on macOS), you can read it and store it as a data frame using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"~/Desktop"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, the entries in the first row will be interpreted as column headings. The <code>read_csv</code> function is part of the readr package from the Tidyverse. Alternatively, you can use the built-in function <code>read.csv</code>. The advantages of <code>read_csv</code> are that it can be faster and simpler to work with. It stores the data as a “Tibble,” which is a modified data frame (see <em>R for Data Science</em> for a discussion of the differences), while some packages expect a traditional data frame. If you think you’ve run into this problem, you can convert a Tibble to a data frame using <code>d &lt;- data.frame(d)</code>.</p>
<p>You can save a data frame (or matrix) as a csv using the command <code>write_csv(d, "filename.csv")</code>. Alternatively, you can use the built-in command <code>write.csv</code>.</p>
<p>You can read Excel files using the <code>read_excel</code> command from the readxl package. The basic syntax is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data.xlsx"</span>, <span class="at">sheet=</span><span class="st">"Sheet1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The haven package from the Tidyverse can import data from several other statistical programs In particular, you can use <code>read_dta</code> to import a Stata file. The foreign package also reads data from other statistical software.</p>
<p>Once you’ve imported some data, you might want to clean up the formatting a little. You can rename one or more variables using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)[<span class="fu">names</span>(d)<span class="sc">==</span><span class="st">"y1"</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"why1"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)[<span class="fu">names</span>(d) <span class="sc">%in%</span> <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"why"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or in the Tidyverse using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">why1 =</span> y1)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">rename_with</span>(\(x) <span class="fu">paste0</span>(<span class="st">"why"</span>, <span class="fu">seq_along</span>(x)), <span class="fu">starts_with</span>(<span class="st">"y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This syntax deserves a bit of explanation. “<code>|&gt;</code>” is the “pipe.” It takes data and “pipes” it into the first argument of the next command (and so only works if the next command takes data as its first argument). The pipe is part of base R, but is most often used with Tidyverse commands.</p>
<p>You can also change the case of variables names using either of the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(d))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">rename_with</span>(tolower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that since we didn’t use <code>d &lt;-</code> to modify the data frame in the second example above, running this command will simply print the data frame (actually, it will print a preview, which is one of the ways that Tibbles differ from data frames).</p>
<p>You can save the image of your entire workspace (all data, functions, etc.) as an RData file using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"filename.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and load an existing image using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"filename.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Aside.</strong> Here is the code I used to generate these data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">replicate</span>(<span class="dv">6</span>, <span class="fu">rnorm</span>(<span class="dv">50</span>)))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">c</span>(<span class="st">"z1"</span>, <span class="st">"z2"</span>)] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">replicate</span>(<span class="dv">2</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">50</span>, </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">replace=</span><span class="cn">TRUE</span>)))</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(d, <span class="at">file=</span><span class="st">"data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>replicate</code> is a member of the apply family (it is equivalent to <code>sapply(1:2, \(x) sample(1:5, 50, replace=TRUE))</code>). <code>rnorm</code> creates draws from a normal distribution.</p>
</section>
<section id="subsetting-data" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-data">Subsetting data</h3>
<p>There are several ways to prune a data frame so that it only contains certain variables. For example, if you want to drop the <code>y</code> variables from <code>d</code>, you can use any of the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"z1"</span>, <span class="st">"z2"</span>)]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>d[ , <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"z1"</span>, <span class="st">"z2"</span>)]</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))]</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">names</span>(d) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))]</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">startsWith</span>(<span class="fu">names</span>(d), <span class="st">"x"</span>) <span class="sc">|</span> <span class="fu">startsWith</span>(<span class="fu">names</span>(d), <span class="st">"y"</span>)]</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>d[<span class="sc">!</span><span class="fu">startsWith</span>(<span class="fu">names</span>(d), <span class="st">"y"</span>)]</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">grep</span>(<span class="st">"^[xz]"</span>, <span class="fu">names</span>(d))]</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(d, <span class="at">select=</span><span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)))</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(d, <span class="at">select=</span><span class="sc">-</span><span class="fu">c</span>(y1, y2, y3))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>d[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are a few notes on these commands: <code>!startsWith(names(d), "y")</code> sepcifices the names in <code>d</code> that <em>don’t</em> start with “y” (<code>!</code> is the logical negation operator). <code>grep("^[xz]", names(d))</code> is a <em>regular expression</em> that returns the names of <code>d</code> that start with either “x” or “z” (regular expressions are useful for working with strings, but I avoid them because I can never remember the syntax). <code>select=-c(y1, y2, y3)</code> returns the subset of <code>d</code> excluding the “y” variables, and <code>d[-c(4, 5, 6)]</code> returns the subset that excludes columns 4-6.</p>
<p>You can also drop a variable using <code>d$z1 &lt;- NULL</code>.</p>
<p>In the Tidyverse, this can be accomplished using the <code>select</code> command from the dplyr package. All of the following do the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">select</span>(x1, x2, x3, z1, z2)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"z"</span>)))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">num_range</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">num_range</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now suppose that you only wanted to retain observations where <code>z1</code> is 4 or 5 and <code>z2</code> is 2. Any of the following would work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>d[(d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">5</span>) <span class="sc">&amp;</span> d<span class="sc">$</span>z2<span class="sc">==</span><span class="dv">2</span>,]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">&amp;</span> d<span class="sc">$</span>z2<span class="sc">==</span><span class="dv">2</span>, ]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(d, d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">&amp;</span> d<span class="sc">$</span>z2<span class="sc">==</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The syntax <code>|</code> means “or”. Sometimes it’s useful to have a detailed understanding of how this kind of subsetting works. The first command above is equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>condition <span class="ot">&lt;-</span> (d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">5</span>) <span class="sc">&amp;</span> d<span class="sc">$</span>z2<span class="sc">==</span><span class="dv">2</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>d[condition, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above, <code>condition</code> is a logical vector (<code>TRUE</code>/<code>FALSE</code> values) indicating whether the condition holds, and <code>d[condition, ]</code> is the subset of <code>d</code> for observations that satisfy the condition (i.e., where <code>condition == TRUE</code>).</p>
<p>We can also using dplyr’s <code>filter</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">filter</span>((z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> z1<span class="sc">==</span><span class="dv">5</span>) <span class="sc">&amp;</span> z2<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">filter</span>(z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">&amp;</span> z2<span class="sc">==</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note.</strong> You can use the pipe to “chain” commands together (this is more common with Tidyverse commands, but it works in base R, too):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">select</span>(z1, z2) <span class="sc">|&gt;</span> <span class="fu">filter</span>(z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">&amp;</span> z2<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">subset</span>(<span class="at">select=</span><span class="fu">c</span>(z1, z2)) <span class="sc">|&gt;</span> <span class="fu">subset</span>((z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> z1<span class="sc">==</span><span class="dv">5</span>) <span class="sc">&amp;</span> z2<span class="sc">==</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could sort our data according to the variable <code>z1</code> using either of</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">order</span>(d<span class="sc">$</span>z1), ]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">arrange</span>(z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we wanted to sort according to <code>z1</code>, and then the value of <code>z2</code> within levels of <code>z1</code>, we could use <code>order(d$z1, d$z2)</code> or <code>arrange(z1, z2)</code>.</p>
</section>
<section id="transforming-data" class="level3">
<h3 class="anchored" data-anchor-id="transforming-data">Transforming data</h3>
<p>The variable <code>z1</code> in the data frame <code>d</code> takes the values 1-5. Suppose we want to recode 4s and 5s to 1 and all other values to zero. We could do this using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">1</span>, ]<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">5</span> , ]<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If <code>d</code> is saved as a data frame instead of a Tibble, this will give us an error if no observations satisfy the condition in brackets, because then we’re trying to replace something that has length zero with something that has positive length (this is another way that Tibbles differ from data frames). We can avoid this by using the following alternative syntax, which always works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">1</span>, <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">5</span>, <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Missing values.</strong> R stores missing values as <code>NA</code>. Our data don’t have any missing values, but if they did, R would return an error using either of these approaches. How missing values are handled differs across commands, so it’s a good idea to be vigilant about potential <code>NA</code>s. If we have missing values (or to be safe if we’re not sure), we can use the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>d[(d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">1</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(d<span class="sc">$</span>z1), <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>d[(d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">4</span> <span class="sc">|</span> d<span class="sc">$</span>z1<span class="sc">==</span><span class="dv">5</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(d<span class="sc">$</span>z1), <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could simplify this using the <code>%in%</code> operator (which also handles <code>NA</code>s correctly):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>d[d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>), <span class="st">"z1"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could also do this in a single line using <em>indicator function</em> notation, in which <code>(expression)</code> evaluates to <code>TRUE</code> if the expression is true and <code>FALSE</code> otherwise. In numeric settings, R will interpret <code>TRUE</code> as 1 and <code>FALSE</code> as 0, and we can use this to force the result to be numeric. Since the indicator function will return zeros for <code>NA</code>s, to be safe we should use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>d[<span class="sc">!</span><span class="fu">is.na</span>(d<span class="sc">$</span>z1),]<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(d[<span class="sc">!</span><span class="fu">is.na</span>(d<span class="sc">$</span>z1),]<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we wanted to do this for both <code>z1</code> and <code>z2</code>, we could use a loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> vars) {</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  d[<span class="sc">!</span><span class="fu">is.na</span>(d[i]), ][i] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(d[<span class="sc">!</span><span class="fu">is.na</span>(d[i]), ][i] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note here that we need to use <code>d[!is.na(d[i]),][i] %in% ...</code> because <code>%in%</code> expects a vector, not a data frame.</p>
<p>To avoid the problems with these approaches, it might be easier to use the built-in <code>replace</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="fu">replace</span>(d<span class="sc">$</span>z1, d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dv">0</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="fu">replace</span>(d<span class="sc">$</span>z1, d<span class="sc">$</span>z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which we could automate using a loop or <code>lapply</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(d[<span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)], </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>                              \(x) <span class="fu">replace</span>(x, x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dv">0</span>))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(d[<span class="fu">paste0</span>(<span class="st">"z"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)], </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                              \(x) <span class="fu">replace</span>(x, x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>), <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dplyr package from the Tidyverse has convenient functions for doing this sort of thing. To recode <code>z1</code>, we can use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">z1 =</span> <span class="fu">case_when</span>(z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                                z1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> z1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mutate</code> is dplyr’s command for transforming and adding variables. The <code>case_when</code> syntax tells R to replace <code>z1</code> with 0 when <code>z1=5</code>, and to use the existing value of <code>z1</code> otherwise.</p>
<p>If we wanted to transform both <code>z1</code> and <code>z2</code> at the same time, we could use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(z1, z2), </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                        \(x) <span class="fu">case_when</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                                       x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">.default =</span> x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above, we could replace <code>c(z1, z2)</code> with <code>all_of(vars)</code>, <code>num_range("z", 1:2)</code>, or <code>starts_with("z")</code>.</p>
<p>If we wanted to create a new variable <code>x1_sq</code> equal to the square of <code>x1</code>, we could use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>x1_sq <span class="ot">&lt;-</span> d<span class="sc">$</span>x1<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we wanted to do this for all of the <code>x</code> variables, we could use either</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  d[<span class="fu">paste0</span>(<span class="st">"x"</span>, i, <span class="st">"_sq"</span>)] <span class="ot">&lt;-</span> d[<span class="fu">paste0</span>(<span class="st">"x"</span>, i)]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or the vectorized approach</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"_sq"</span>)] <span class="ot">&lt;-</span> d[<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the Tidyverse, we could use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">x1_sq =</span> x1<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>for one variable, or for multple variables,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">x1_sq =</span> x1<span class="sc">^</span><span class="dv">2</span>, <span class="at">x2_sq =</span> x2<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">num_range</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.fns =</span> <span class="fu">list</span>(<span class="at">sq =</span> \(x) x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.names =</span> <span class="st">"{col}_{fn}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could add additional functions to the list if we wanted to add multiple transformations of these variables.</p>
</section>
<section id="merging-and-reshaping-data" class="level3">
<h3 class="anchored" data-anchor-id="merging-and-reshaping-data">Merging and reshaping data</h3>
<p>Imagine that our (pre re-coding) variables <code>z1</code> and <code>z2</code> represent “state” and “year”. Suppose that we have another dataset that records the values of some different variables for each state and year. How could we merge this dataset to our original dataset <code>d</code>?</p>
<p>First, let’s make such a dataset. We want all combinations of <code>z1</code> and <code>z2</code>, each of which take the values 1-5. We can create all of these combinations using the <code>expand.grid</code> function, then make some fake data for each combination:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">z1=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">z2=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>w1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">25</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>w2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">25</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>d.new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(temp, w1, w2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use the <code>merge</code> function to combine this new data frame with <code>d</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>d.merged <span class="ot">&lt;-</span> <span class="fu">merge</span>(d, d.new, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"z1"</span>, <span class="st">"z2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are some options to the merge function. For example, you might want the merged data to include values from <code>d.new</code> that don’t appear in <code>d</code> (which doesn’t occur in our example), see <code>help(merge)</code> for details.</p>
<p>You can also do this using the <code>left_join</code> command from dplyr:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>d.merged2 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">left_join</span>(d.new, <span class="fu">join_by</span>(z1, z2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A left join keeps all rows in the original dataset (we might throw away some rows from the new dataset if they don’t correspond to any values in the original). There are also right joins (keep all rows from the new dataset), full joins (keep all rows from both), and inner joins (only keep rows that appear in both). These correspond to the options in the base-R <code>merge</code> function.</p>
<p>Now suppose that the variables <code>x1</code>-<code>x3</code> and <code>y1</code>-<code>y3</code> represent observations on the same variable for different units in different time periods (i.e., panel data). It is often easier to work with panel data in <em>long form</em>, which has one column per variable but multiple rows per unit, one for each time period.</p>
<p>It isn’t too hard to reshape a dataset into long form in base R, but I always found the documentation a little confusing. First, we need to add an “id” variable that identifies each unit (we can do this using the <code>dim</code> function, which returns a vector containing the dimensions of an array). Then we can use the <code>reshape</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>]</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>d.long <span class="ot">&lt;-</span> <span class="fu">reshape</span>(d, <span class="at">idvar=</span><span class="st">"id"</span>, </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">varying=</span><span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)), </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep=</span><span class="st">""</span>, <span class="at">direction=</span><span class="st">"long"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could use regular expressions to replace the <code>varying</code> command with <code>varying=grep("^x|^y", names(d))</code>, which selects all variables that start with “x” or “y” (or we could just type everything manually using <code>varing=c("x1", "x2", ...)</code>).</p>
<p>In the Tidyverse, this can be accomplished using the <code>pivot_longer</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>d.long <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"time"</span>),</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">names_pattern =</span> <span class="st">"([A-Za-z]+)(</span><span class="sc">\\</span><span class="st">d+)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, <code>cols</code> determines which columns get reshaped to long form, <code>names_to</code> determines what we do with the different parts of variable names like <code>x1</code> (we use the first part to name the variable and the second to index the time period), and <code>names_pattern</code> determines how we split names like <code>x1</code> into parts. In this case, <code>names_pattern</code> uses a regular expression that looks for letters followed by numbers. Unfortunately, this is the only syntax that reliably works in all cases (if our variables were named like “<code>x_1</code>”, we could replace this with the simpler <code>names_sep="_"</code>). We could, however, replace the <code>cols</code> statement with the simpler <code>cols = starts_with(c("x", "y"))</code> or <code>cols = c(num_range("x", 1:3), num_range("y", 1:3))</code>.</p>
<p>To reshape back to “wide” form, we can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>d.wide <span class="ot">&lt;-</span> <span class="fu">reshape</span>(d.long, <span class="at">idvar=</span><span class="st">"id"</span>, <span class="at">timevar=</span><span class="st">"time"</span>, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">direction=</span><span class="st">"wide"</span>, <span class="at">v.names=</span><span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or, in the Tidyverse,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>d.wide <span class="ot">&lt;-</span> d.long <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from=</span><span class="st">"time"</span>, </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">values_from=</span><span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_glue=</span><span class="st">"{.value}{time}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics">Summary statistics</h3>
<p>R doesn’t have a great built-in way to easily get descriptive statistics. You can get some descriptives for a data frame (or a subset of one) using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1                 x2                x3                  y1          
 Min.   :-1.94396   Min.   :-2.0193   Min.   :-2.395694   Min.   :-2.15245  
 1st Qu.:-0.62954   1st Qu.:-0.8372   1st Qu.:-0.620201   1st Qu.:-0.81119  
 Median : 0.07309   Median :-0.2028   Median : 0.006369   Median : 0.13922  
 Mean   : 0.10972   Mean   :-0.1018   Mean   : 0.018148   Mean   :-0.02562  
 3rd Qu.: 0.61040   3rd Qu.: 0.4488   3rd Qu.: 0.593582   3rd Qu.: 0.55230  
 Max.   : 2.72821   Max.   : 2.1323   Max.   : 1.918224   Max.   : 1.90431  
       y2                y3                z1             z2      
 Min.   :-1.8943   Min.   :-2.7330   Min.   :1.00   Min.   :1.00  
 1st Qu.:-0.4492   1st Qu.:-0.8780   1st Qu.:2.00   1st Qu.:2.00  
 Median : 0.2419   Median :-0.4337   Median :3.00   Median :3.00  
 Mean   : 0.1493   Mean   :-0.2758   Mean   :2.92   Mean   :3.06  
 3rd Qu.: 0.7228   3rd Qu.: 0.6060   3rd Qu.:4.00   3rd Qu.:4.00  
 Max.   : 2.4996   Max.   : 2.0274   Max.   :5.00   Max.   :5.00  
       id       
 Min.   : 1.00  
 1st Qu.:13.25  
 Median :25.50  
 Mean   :25.50  
 3rd Qu.:37.75  
 Max.   :50.00  </code></pre>
</div>
</div>
<p>but chances are you want to know the sample size, standard deviation, etc. as well.</p>
<p>However, there are several packages that can do this. One easy approach is using <code>describe</code> from the <code>psych</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(d, <span class="at">fast=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   vars  n  mean    sd median   min   max range  skew kurtosis   se
x1    1 50  0.11  1.02   0.07 -1.94  2.73  4.67  0.52     0.09 0.14
x2    2 50 -0.10  0.96  -0.20 -2.02  2.13  4.15  0.24    -0.44 0.14
x3    3 50  0.02  0.91   0.01 -2.40  1.92  4.31 -0.05     0.22 0.13
y1    4 50 -0.03  1.04   0.14 -2.15  1.90  4.06 -0.25    -0.78 0.15
y2    5 50  0.15  0.87   0.24 -1.89  2.50  4.39 -0.08    -0.06 0.12
y3    6 50 -0.28  0.99  -0.43 -2.73  2.03  4.76 -0.22    -0.01 0.14
z1    7 50  2.92  1.35   3.00  1.00  5.00  4.00  0.00    -1.27 0.19
z2    8 50  3.06  1.41   3.00  1.00  5.00  4.00 -0.15    -1.32 0.20
id    9 50 25.50 14.58  25.50  1.00 50.00 49.00  0.00    -1.27 2.06</code></pre>
</div>
</div>
<p>Here, we used the <code>fast=TRUE</code> option to get a more limited set of statistics. You can also use <code>describeBy</code> to get descriptives within groups.</p>
<p>You can also calculate your own descriptive statistics. For example, to get the sample size, mean and standard deviation, you could use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d[<span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="dv">2</span>, \(x) <span class="fu">c</span>(<span class="at">n=</span><span class="fu">length</span>(x), <span class="at">mean=</span><span class="fu">mean</span>(x), <span class="at">sd=</span><span class="fu">sd</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              y1        y2         y3
n    50.00000000 50.000000 50.0000000
mean -0.02562224  0.149286 -0.2757643
sd    1.04306947  0.868742  0.9878856</code></pre>
</div>
</div>
<p>Our sample data don’t have any missing values, but if they did, our statistics would also be <code>NA</code>. We could use <code>is.na</code> to get the sample size, and add the <code>na.rm=TRUE</code> option to the <code>mean</code> and <code>sd</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d[<span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="dv">2</span>, \(x) <span class="fu">c</span>(<span class="at">n=</span><span class="fu">sum</span>(<span class="fu">is.na</span>(x)), </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">mean=</span><span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">sd=</span><span class="fu">sd</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can calculate statistics within groups using <code>aggregate</code> (which omits missing values by default). To get the sample size, mean and median of <code>y1</code>-<code>y3</code> by <code>z1</code> and <code>z2</code> you could use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">aggregate</span>(<span class="fu">cbind</span>(y1, y2, y3) <span class="sc">~</span> z1 <span class="sc">+</span> z2, d, </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  \(x) <span class="fu">c</span>(<span class="at">n =</span> <span class="fu">length</span>(x), <span class="at">mean=</span><span class="fu">mean</span>(x), <span class="at">sd=</span><span class="fu">sd</span>(x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  z1 z2        y1.n     y1.mean       y1.sd       y2.n    y2.mean      y2.sd
1  2  1  3.00000000 -0.15625681  1.59970107  3.0000000 -0.1648793  1.5722075
2  3  1  2.00000000 -0.02454541  0.20067036  2.0000000  0.2116156  1.0023726
3  4  1  3.00000000  0.08727342  0.64314253  3.0000000  0.1789289  0.7663552
4  5  1  2.00000000  1.02753392  0.14723381  2.0000000  0.9686784  0.3591143
5  1  2  2.00000000 -0.20859931  2.67238968  2.0000000  0.9521382  0.9171654
6  2  2  1.00000000 -1.02335712          NA  1.0000000 -0.2331576         NA
        y3.n    y3.mean      y3.sd
1  3.0000000 -0.7569015  0.1534366
2  2.0000000  0.1597525  0.6511911
3  3.0000000 -1.3442514  1.2223017
4  2.0000000 -0.2588588  0.9739089
5  2.0000000 -0.3362057  0.4113071
6  1.0000000 -0.7457210         NA</code></pre>
</div>
</div>
<p>Here, we used <code>cbind</code> to apply <code>aggregate</code> to multiple variables (this trick often works with commands that take “<code>~</code>” formulas, including the regression command <code>lm</code> introduced below). We also used the <code>head</code> function to only print the first few rows of output. From here, you could also store the results as a data frame in order to export them to a spreadsheet program for further editing.</p>
<p>The dplyr package is particularly convenient for descriptive statistics. To get the sample size, mean and standard deviation, we can use <code>summarize</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">y1_mean =</span> <span class="fu">mean</span>(y1, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">y1_sd =</span> <span class="fu">sd</span>(y1, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      y1_mean    y1_sd  n
1 -0.02562224 1.043069 50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">num_range</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x), <span class="at">sd =</span> \(x) <span class="fu">sd</span>(x))), </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      y1_mean    y1_sd  y2_mean    y2_sd    y3_mean     y3_sd  n
1 -0.02562224 1.043069 0.149286 0.868742 -0.2757643 0.9878856 50</code></pre>
</div>
</div>
<p>the sample size <code>n</code> gets special treatment here because it applies to the entire dataset, not any specific variable (alternatively, we could use <code>n=\(x) sum(is.na(x))</code> as above).</p>
<p>We could do this by <code>z1</code> and <code>z2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">group_by</span>(z1, z2) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">num_range</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sd =</span> \(x) <span class="fu">sd</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))), </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'z1'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 9
# Groups:   z1 [5]
      z1    z2 y1_mean  y1_sd y2_mean  y2_sd y3_mean  y3_sd     n
   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
 1     1     2 -0.209   2.67    0.952  0.917  -0.336  0.411     2
 2     1     3 -0.388  NA      -0.155 NA       0.896 NA         1
 3     1     4  0.691   1.57    0.162  0.953  -0.160  0.675     4
 4     1     5  0.641   0.288   0.193  0.726  -0.346  1.36      3
 5     2     1 -0.156   1.60   -0.165  1.57   -0.757  0.153     3
 6     2     2 -1.02   NA      -0.233 NA      -0.746 NA         1
 7     2     3  0.199   0.798   0.303  0.444  -0.106  1.84      4
 8     2     4 -0.995  NA       0.275 NA       0.723 NA         1
 9     2     5 -0.716  NA      -1.35  NA      -0.806 NA         1
10     3     1 -0.0245  0.201   0.212  1.00    0.160  0.651     2
# ℹ 13 more rows</code></pre>
</div>
</div>
<p>If you wanted to add these summaries back to your dataset, you could save them as a data frame, then do a merge. Alternatively, you can use base-R’s <code>ave</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>d[<span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"_mean"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(d[<span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>                                       \(x) <span class="fu">ave</span>(x, <span class="fu">list</span>(d<span class="sc">$</span>z1, d<span class="sc">$</span>z2), </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">FUN=</span>mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(it might be simpler to do this using a loop), or obtain the statistics using dplyr’s <code>mutate</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">group_by</span>(z1, z2) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">num_range</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x), </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">sd =</span> \(x) <span class="fu">sd</span>(x)),</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">.names =</span> <span class="st">"{col}_{fn}"</span>), </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can create tables for discrete variables using the <code>table</code> command. The basic syntax simply produces counts, but it can be used with <code>prop.table</code> to get proportions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4  5 
10 10 11 12  7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(d<span class="sc">$</span>z1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2    3    4    5 
0.20 0.20 0.22 0.24 0.14 </code></pre>
</div>
</div>
<p>To perform crosstabs, you can use either <code>table</code> or the somewhat more convenient <code>xtabs</code> command. When we use <code>prop.table</code> with a two-dimensional table, we have to specify whether we want row proportions (with a <code>1</code>) or column proportions (with a <code>2</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(d<span class="sc">$</span>z1, d<span class="sc">$</span>z2), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
             1          2          3          4          5
  1 0.00000000 0.20000000 0.10000000 0.40000000 0.30000000
  2 0.30000000 0.10000000 0.40000000 0.10000000 0.10000000
  3 0.18181818 0.18181818 0.00000000 0.36363636 0.27272727
  4 0.25000000 0.08333333 0.33333333 0.25000000 0.08333333
  5 0.28571429 0.28571429 0.14285714 0.14285714 0.14285714</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">xtabs</span>( <span class="sc">~</span> z1 <span class="sc">+</span> z2, d), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   z2
z1           1          2          3          4          5
  1 0.00000000 0.25000000 0.10000000 0.30769231 0.33333333
  2 0.30000000 0.12500000 0.40000000 0.07692308 0.11111111
  3 0.20000000 0.25000000 0.00000000 0.30769231 0.33333333
  4 0.30000000 0.12500000 0.40000000 0.23076923 0.11111111
  5 0.20000000 0.25000000 0.10000000 0.07692308 0.11111111</code></pre>
</div>
</div>
<p>We could use, e.g., <code>round(prop.table(xtabs( ~ z1 + z2, d), 2), 2)</code>, to round the decimals to two places.</p>
</section>
<section id="visualizing-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-data">Visualizing data</h3>
<p>R’s graphing capabilities extend well beyond what can be covered in a short introduction, so we’ll only sketch the basics, give a sense of the possibilities, and point in the direction of further resources.</p>
<p>The basics of R’s built-in plotting functions are easy. For example, you can obtain histogram using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is a scatter plot, with a title and custom axis labels and a regression line (via the <code>abline</code> command):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d<span class="sc">$</span>x1, d<span class="sc">$</span>y1, <span class="at">xlab=</span><span class="st">"Amount of x1"</span>, <span class="at">ylab=</span><span class="st">"Amoun tof y1"</span>, </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Scatter plot of y1 against x1"</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y1 <span class="sc">~</span> x1, d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I often use Base-R graphics to create simple line diagrams. Here’s how we can plot the densities for two normal distributions with different variances:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, d1, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">ylab=</span><span class="st">"Density"</span>)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, d2, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">bty=</span><span class="st">"n"</span>, <span class="fu">c</span>(<span class="st">"N(0, 1)"</span>, <span class="st">"N(0, 2)"</span>), </span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, <code>dnorm</code> returns the normal density (there is also <code>pnorm</code> for the distribution function and <code>qnorm</code> for the quantiles, useful for computing critical values), <code>plot</code> displays the initial curve, <code>lines</code> adds the second, <code>legend</code> adds the legend, <code>type="l"</code> gives a line (rather than underlying points), <code>col</code> controls the colors, <code>lty</code> controls the line type (solid or dashed), and <code>bty="n"</code> stops R from putting a box around the legend.</p>
<p>As you can see, base-R plots have a lot of options. You can read about them by typing <code>help(plot)</code>, or just search the web.</p>
<p>There is another plotting system called ggplot2 which is part of the Tidyverse, is very versatile, and has much more accessible documentation. Roughly speaking, you specify the data, then the geometric objects, describing the aesthetics of the plot along the way. For example, we could make a basic histogram and scatterplot using, saving the latter as a PDF, using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>d, <span class="fu">aes</span>(<span class="at">x=</span>x1)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>y1)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"scatter.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are some more complicated examples, adapted from <em>R for Data Science</em>. The following produces a scatterplot of <code>y1</code> against <code>x1</code>, with the color and shape of the points determined by the value of <code>z1</code>, along with a linear fit and labelled axes (note that this requires that we treat <code>z1</code> as a factor variable):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(x1, y1)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>z1, <span class="at">shape=</span><span class="fu">as.factor</span>(z1))) <span class="sc">+</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x1"</span>, <span class="at">y=</span><span class="st">"y1"</span>, <span class="at">color=</span><span class="st">"z1"</span>, <span class="at">shape=</span><span class="st">"z1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also use <code>facet_wrap</code> (also see <code>facet_grid</code>) to make subplots for different values of a categorical variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a binary group variable based on z2</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">gp =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">*</span>(z2<span class="sc">&lt;</span><span class="dv">3</span>) <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>(z2<span class="sc">&gt;=</span><span class="dv">3</span>)))</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(x1, y1)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>z1, <span class="at">shape=</span><span class="fu">as.factor</span>(z1))) <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> gp) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x1"</span>, <span class="at">y=</span><span class="st">"y1"</span>, <span class="at">color=</span><span class="st">"z1"</span>, <span class="at">shape=</span><span class="st">"z1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is a bar graph of <code>z2</code>, with the bars broken down by <code>group</code> (note that we use <code>as.factor</code> because <code>z1</code> is not saved as a factor variable):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="fu">as.factor</span>(z1), <span class="at">fill=</span>gp)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"z1"</span>, <span class="at">fill=</span><span class="st">"Group"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And here are separate kernel densities for <code>y1</code> for each value of <code>group</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(y1, <span class="at">color=</span>gp, <span class="at">fill=</span>gp)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha=</span>.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NotesOnR_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regression-basics" class="level3">
<h3 class="anchored" data-anchor-id="regression-basics">Regression basics</h3>
<p>An introduction like this one is also not the place to go into detail on statistical or econometric estimation commands, but we can highlight some techniques that come up frequently.</p>
<p>In R, estimated models are most usefully stored as objects which can be accessed later. For example, to run an OLS regression and view the results, you can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y1 <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, d)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ x1 + x2 + x3, data = d)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.0277 -0.7679  0.1993  0.7355  2.1677 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.01206    0.14987  -0.080    0.936
x1          -0.06640    0.15017  -0.442    0.660
x2           0.01543    0.15725   0.098    0.922
x3          -0.25943    0.16790  -1.545    0.129

Residual standard error: 1.049 on 46 degrees of freedom
Multiple R-squared:  0.05134,   Adjusted R-squared:  -0.01053 
F-statistic: 0.8298 on 3 and 46 DF,  p-value: 0.4843</code></pre>
</div>
</div>
<p>Since the model has been saved, we can refer back to it and everything saved along with it (you can see everything saved with the model using <code>str(model1)</code> or <code>names(model1)</code>). For example, we can extract the coefficients using either of the following <code>model$coefficients</code> or <code>coef(model1)</code>.</p>
<p>We can extract the variance-covariance matrix using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              (Intercept)           x1          x2            x3
(Intercept)  0.0224618504 -0.002226572 0.002111048 -0.0007521723
x1          -0.0022265716  0.022551337 0.003262413  0.0046395898
x2           0.0021110485  0.003262413 0.024728827  0.0026378130
x3          -0.0007521723  0.004639590 0.002637813  0.0281889529</code></pre>
</div>
</div>
<p>and the residuals and predicted values using <code>model1$residuals</code> and <code>model1$fitted.values</code>. If we wanted to obtain the predicted values from applying our model to a different dataset, we could use <code>predict(model1, dataset)</code>.</p>
<p>R has useful syntax for adding terms to a model. We can use <code>:</code> to get the interaction between two variables, <code>*</code> to get interactions and main effects, <code>I()</code> for transformations of variables, and <code>as.factor</code> to include indicators for every level of a categorical variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y1 <span class="sc">~</span> x1<span class="sc">*</span>x2 <span class="sc">+</span> x1<span class="sc">:</span>x3 <span class="sc">+</span> <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(z1), d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y1 ~ x1 * x2 + x1:x3 + I(x2^2) + as.factor(z1), 
    data = d)

Coefficients:
   (Intercept)              x1              x2         I(x2^2)  as.factor(z1)2  
       0.38126        -0.09714         0.06716         0.11604        -0.71730  
as.factor(z1)3  as.factor(z1)4  as.factor(z1)5           x1:x2           x1:x3  
      -0.15187        -0.86856        -0.80041         0.02989        -0.03123  </code></pre>
</div>
</div>
<p>Note that when we use <code>lm</code> without saving it, R simply prints the coefficients (without standard errors or other statistics).</p>
<p>When we use <code>as.factor</code> to include all levels of <code>z1</code>, R automatically chooses an omitted category. We can omit the constant by starting the right-hand side of the formula with a zero (<code>y1 ~ 0 + as.factor(z1) + ...</code>), in which case R won’t omit any category. We can also specify the omitted category by incuding <code>z1</code> in the formula using <code>relevel(as.factor(z1), ref=2)</code>. If we are going to be treating <code>z1</code> as a factor in many commands, we can permanently convert and set its baseline category using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(d<span class="sc">$</span>z1)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>z1 <span class="ot">&lt;-</span> <span class="fu">relevel</span>(d<span class="sc">$</span>z1, <span class="at">ref=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use the <code>linearHypothesis</code> function from the car package to test linear hypotheses, and the <code>deltaMethod</code> function to test nonlinear ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(model1, <span class="fu">c</span>(<span class="st">"x1 + x2=0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
x1  + x2 = 0

Model 1: restricted model
Model 2: y1 ~ x1 + x2 + x3

  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1     47 50.628                           
2     46 50.575  1  0.053104 0.0483  0.827</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deltaMethod</span>(model1, <span class="fu">c</span>(<span class="st">"x1^2 + x2/2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate        SE     2.5 % 97.5 %
x1^2 + x2/2  0.012123  0.078401 -0.141540 0.1658</code></pre>
</div>
</div>
<p>By default, R doesn’t report confidence intervals, but you can obtain them using <code>confint(model1)</code>.</p>
<p>The sandwich package supports robust and clustered standard errors. The easiest way to report them is using the <code>coeftest</code> function from the lmtest package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(model1, <span class="at">vcov=</span>vcovHC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.012058   0.159304 -0.0757   0.9400
x1          -0.066404   0.177596 -0.3739   0.7102
x2           0.015426   0.151925  0.1015   0.9196
x3          -0.259434   0.205761 -1.2609   0.2137</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(model1, <span class="at">vcov=</span><span class="fu">vcovCL</span>(model1, <span class="at">cluster =</span> <span class="sc">~</span> z2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) -0.012058   0.099796 -0.1208  0.90436  
x1          -0.066404   0.076382 -0.8694  0.38916  
x2           0.015426   0.171451  0.0900  0.92870  
x3          -0.259434   0.139238 -1.8632  0.06882 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Note that there are several variants on the robust and cluster-robust variance estimators, and you can use the <code>type</code> option to specify which one you want (see <code>help(vcovHC)</code> and <code>help(vcovCL)</code> for some details).</p>
<p>You can estimate binary choice models using the generalized linear models function <code>glm</code>. The syntax for a probit is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>y1.bin <span class="ot">&lt;-</span> (d<span class="sc">$</span>y1 <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y1.bin <span class="sc">~</span> x1 <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(z1), </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span>probit), d)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(probit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y1.bin ~ x1 + I(x1^2) + as.factor(z1), family = binomial(link = probit), 
    data = d)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)     0.74569    0.47774   1.561    0.119
x1             -0.16422    0.21318  -0.770    0.441
I(x1^2)        -0.08172    0.13168  -0.621    0.535
as.factor(z1)2 -0.73018    0.60978  -1.197    0.231
as.factor(z1)3 -0.24982    0.58816  -0.425    0.671
as.factor(z1)4 -0.87343    0.57885  -1.509    0.131
as.factor(z1)5 -0.54821    0.66249  -0.828    0.408

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 68.593  on 49  degrees of freedom
Residual deviance: 64.627  on 43  degrees of freedom
AIC: 78.627

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>We could get a logit by using <code>link=logit</code> instead.</p>
<p>Both the marginaleffects and margins package can be used to obtain marginal effects. For example, we can obtain average marginal effects using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_slopes</span>(probit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term Contrast Estimate Std. Error      z Pr(&gt;|z|)   S  2.5 % 97.5 %
   x1    dY/dX  -0.0666      0.074 -0.899    0.368 1.4 -0.212 0.0785
   z1    2 - 1  -0.2663      0.210 -1.266    0.205 2.3 -0.679 0.1459
   z1    3 - 1  -0.0844      0.197 -0.429    0.668 0.6 -0.470 0.3010
   z1    4 - 1  -0.3212      0.196 -1.636    0.102 3.3 -0.706 0.0637
   z1    5 - 1  -0.1959      0.233 -0.841    0.400 1.3 -0.653 0.2607

Type: response</code></pre>
</div>
</div>
<p>Since we used <code>I()</code> to include the quadratic term and <code>as.factor</code> to include <code>z1</code>, <code>marginaleffects</code> knows to treat <code>x1</code> and its square as a single expression, and to determine the marginal effects of <code>z1</code> using discrete differences.</p>
<p>There are several packages that format regression tables and export them to other formats (e.g., LaTeX or HTML), including texreg, stargazer, and modelsummary, all of which allow you to customize the contents of the tables.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>For example, we can run regressions for each level of <code>z1</code> (as we saw in the <em>Programming tools</em> section, there are multiple ways to do this), then summarize the results in a single table, and export that table (the following example uses texreg, but the alternative packages work similarly):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>models.z1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(d<span class="sc">$</span>z1)), \(i) <span class="fu">lm</span>(y1 <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>                                                d[d<span class="sc">$</span>z1<span class="sc">==</span>i, ]))</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(models.z1) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"z1 = "</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(d<span class="sc">$</span>z1)))</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(models.z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================================
             z1 = 1  z1 = 2  z1 = 3  z1 = 4   z1 = 5
----------------------------------------------------
(Intercept)   0.57   -0.20    0.45   -0.16    -0.04 
             (0.60)  (0.48)  (0.30)  (0.17)   (0.27)
x1           -0.30    0.17   -0.46   -0.44 *   1.11 
             (0.46)  (0.47)  (0.32)  (0.17)   (0.36)
x2           -0.03    0.02   -0.12   -0.07    -0.43 
             (0.81)  (0.61)  (0.29)  (0.15)   (0.35)
x3           -0.35   -0.02   -0.27   -0.59 *  -1.68 
             (0.52)  (0.49)  (0.35)  (0.20)   (0.65)
----------------------------------------------------
R^2           0.10    0.02    0.25    0.62     0.83 
Adj. R^2     -0.35   -0.46   -0.07    0.48     0.67 
Num. obs.    10      10      11      12        7    
====================================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(models.z1, <span class="at">file=</span><span class="st">"models_z1.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to use robust or clustered standard errors, we need to do a little more work to add them to the table. Here’s how we can display robust standard errors (and significance stars based on them) using stargazer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>ses.z1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models.z1, \(x) <span class="fu">coeftest</span>(x, vcovHC)[, <span class="dv">2</span>])</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>ps.z1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models.z1, \(x) <span class="fu">coeftest</span>(x, vcovHC)[, <span class="dv">4</span>])</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(models.z1, <span class="at">override.se =</span> ses.z1, <span class="at">override.pvalues =</span> ps.z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=====================================================
             z1 = 1  z1 = 2  z1 = 3  z1 = 4    z1 = 5
-----------------------------------------------------
(Intercept)   0.57   -0.20    0.45   -0.16     -0.04 
             (0.81)  (0.62)  (0.43)  (0.19)    (0.39)
x1           -0.30    0.17   -0.46   -0.44 **   1.11 
             (0.66)  (1.00)  (0.50)  (0.09)    (0.62)
x2           -0.03    0.02   -0.12   -0.07     -0.43 
             (1.34)  (1.30)  (0.34)  (0.21)    (0.56)
x3           -0.35   -0.02   -0.27   -0.59     -1.68 
             (0.68)  (0.67)  (0.55)  (0.37)    (0.75)
-----------------------------------------------------
R^2           0.10    0.02    0.25    0.62      0.83 
Adj. R^2     -0.35   -0.46   -0.07    0.48      0.67 
Num. obs.    10      10      11      12         7    
=====================================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>As another example, we could create a table consisting of different model specifications:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x1 + x2"</span>, <span class="st">"x1 + x2 + x3"</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>specifications <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, \(x) <span class="fu">lm</span>(<span class="fu">paste0</span>(<span class="st">"y1 ~"</span>, x), d))</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(specifications)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================
             Model 1  Model 2  Model 3
--------------------------------------
(Intercept)  -0.02    -0.02    -0.01  
             (0.15)   (0.15)   (0.15) 
x1           -0.03    -0.02    -0.07  
             (0.15)   (0.15)   (0.15) 
x2                     0.04     0.02  
                      (0.16)   (0.16) 
x3                             -0.26  
                               (0.17) 
--------------------------------------
R^2           0.00     0.00     0.05  
Adj. R^2     -0.02    -0.04    -0.01  
Num. obs.    50       50       50     
======================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Here are a few additional packages that are useful for regressions and econometrics:</p>
<ul>
<li>The plm package estimates panel data models, including fixed and random effects</li>
<li>The fixest package estimates fixed effects models efficiently, works with multiple dimensions of fixed effects, and has built-in clustering and graphing capabilities</li>
<li>The ivreg packages handles instrumental variables and two-stage least squares</li>
</ul>
</section>
</section>
<section id="resources-for-more" class="level2">
<h2 class="anchored" data-anchor-id="resources-for-more">Resources for more</h2>
<ul>
<li><a href="https://cran.r-project.org/doc/manuals/R-intro.pdf">An introduction to R</a> by Venebales, Smith, et al.&nbsp;is a classic introduction to R, and also comes bundled with R itself</li>
<li><a href="https://github.com/matloff/fasteR">FasteR: Fast Lane to Learning R</a> by Matloff is a detailed tutorial, with a focus on base R</li>
<li><a href="https://r4ds.hadley.nz/">R for Data Science</a> by Wickham, Cetinkaya-Rundel and Grolemund is an excellent introduction to using R via the Tidyverse (the <a href="https://r4ds.had.co.nz">first edition</a> touches on a few useful topics omitted from the second)</li>
<li><a href="https://adv-r.hadley.nz">Advanced R</a> by Wickham delves into some of the more technical details of working with R (also see the <a href="http://adv-r.had.co.nz">first edition</a>)</li>
<li><a href="https://ggplot2-book.org/">Ggplot2: Elegant Graphics for Data Analysis</a> by Wickham is a deep dive into ggplot2</li>
<li><em>The Art of R Programming</em> by Matloff provides a lot of details on R programming, with a focus on base R</li>
</ul>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>If you’re feeling rebellious, you can go the other way: <code>c(1, 2, 3) -&gt; a</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The <code>diag</code> function contains multitudes. If you have a vector <code>a</code>, <code>diag(a)</code> will create a matrix with the elements of <code>a</code> on the diagonal, and zeros elsewhere. If you have a square matrix <code>A</code>, <code>diag(A)</code> will return a vector consisting of the diagonal elements of <code>A</code>. Somehow this all makes sense when you’re actually using it.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Here is the bisection algorithm. Pick a point <span class="math inline">\(L\)</span> where <span class="math inline">\(f(L)&lt;0\)</span> and a point <span class="math inline">\(H\)</span> where <span class="math inline">\(f(H)&gt;0\)</span>, then calculate the midpoint <span class="math inline">\(M\)</span>. If <span class="math inline">\(|f(M)|&lt;\epsilon\)</span>, stop. Otherwise, if <span class="math inline">\(f(L)*f(M)&lt;0\)</span>, the root is between <span class="math inline">\(L\)</span> and <span class="math inline">\(M\)</span>, so start over, replacing <span class="math inline">\(H\)</span> with <span class="math inline">\(M\)</span>. If <span class="math inline">\(f(L)*f(M)&gt;0\)</span>, the root is between <span class="math inline">\(M\)</span> and <span class="math inline">\(H\)</span>, so start over, replacing <span class="math inline">\(L\)</span> with <span class="math inline">\(M\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The <em>purrr</em> package from the Tidyverse has a modified version of <code>lapply</code> called <code>map</code>, which works essentially the same way, but offers a few additional conveniences (see <em>R for Data Science</em> for more).<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Although these commands export LaTeX tables, I often find that they need further editing. Instead, I export to HTML (which can be opened in Excel), edit them, then paste them into LyX or use Excel2LaTeX to get LaTeX-formatted tables.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>